# RDS 연결

## 보안그룹 만들기

ec2 > 보안그룹 > 보안그룹생성  
이름, 설명을 기재하고 vpc는 eks의 vpc 선택.  
인바운드 규칙에 내 유형에는 postgresql, 소스는 PC의 IP, eks의 네트워킹에 클러스터 보안 그룹의 아이디를 선택한다.

## RDS, DB 서브넷 그룹 생성

RDS > 서브넷 그룹 > DB 서브넷 그룹 생성  
이름, 설명을 기재하고 vpc는 eks의 vpc 선택.  
서브넷 추가부분에 가용영역에는 eks의 vpc의 가용영역을 선택하고 서브넷은 Private Subnet만 선택한다. (VPC > 서브넷에 가면 private를 확인할 수 있다.)

## 데이터베이스 생성

RDS > 데이터베이스 > 데이터베이스 생성
postgresql 선택  
템플릿은 프리티어 (용도에 맞게 선택)  
DB 인스턴스 식별자는 원하는 것으로 선택  
비밀번호는 자체 관리하여 원하는 것으로 기재  
vpc는 eks의 vpc 선택  
db서브넷 그룹은 상단에서 만든것 선택  
퍼블릭 액세스는 집에서 접속할 것이면 예, eks에서만 접속할것이면 아니오  
보안그룹은 상단에서 만든 것 선택  
가용영역은 vpc와 동일한 곳 1곳 선택  
데이터베이스 생성

## 외부 접속을 위한 라우팅 테이블 설정

데이터 베이스 생성 때 선택했던 가용영역의 private의 라우팅 테이블로 들어갑니다.  
vpc를 선택해서 들어가면 보기 쉽습니다.  
라우팅테이블을 선택해서 라우팅을 편집하고 대상에 보안그룹을 만들때 넣었던 나의 아이피 그리고 대상에 인터넷 게이트웨이를 선택하고 이어줍니다.  
그럼 dbeaver 등을 통해서 외부접속이 가능한 것을 볼 수 있습니다.

## 구현

[Github Link](https://github.com/gornoba/eks-nest/tree/1ac0cc4184ff379f0cdc7c76156fed2ead65579b/aws/rds)  
구현할 때 aws의 postgres는 ssl 관련 설정을 해줘야 합니다.  
그리고 비밀번호가 바뀌었다면 secret도 변경해줘야 합니다.
